# Vercel 404 Diagnosis & Fix Guide

## Root Cause Analysis

Your Aswang Chronicles app is a **Single Page Application (SPA)** built with Vite. The 404 errors occur because:

1. **Direct URL Access**: When users visit `/game`, `/archives`, etc. directly, Vercel looks for physical files at those paths
2. **Missing Rewrite Rules**: Without proper configuration, server doesn't know to serve `index.html` for all routes
3. **Client-Side Routing**: Your app uses client-side routing, but server needs to be configured to support it

## âœ… FIXES IMPLEMENTED

### 1. Created `vercel.json` Configuration
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist", 
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```
**What this does**: Routes ALL requests to `index.html`, letting your client-side router handle routing.

### 2. Added `public/_redirects` (Netlify Fallback)
```
/*    /index.html   200
```
**What this does**: Provides the same functionality for Netlify deployments.

### 3. Enhanced Security Headers
Added security headers in `vercel.json` for:
- Content Security Policy
- XSS Protection
- Frame Options
- Cache Control for static assets

## ğŸ” DIAGNOSTIC CHECKLIST

### Before Deployment:
1. âœ… Build completes successfully (`npm run build`)
2. âœ… `dist/index.html` exists
3. âœ… `vercel.json` is in project root
4. âœ… Routes are properly defined in `src/main.js`

### After Deployment:
1. **Test Direct URL Access**:
   - `https://your-domain.vercel.app/` âœ“
   - `https://your-domain.vercel.app/game` âœ“
   - `https://your-domain.vercel.app/archives` âœ“
   - `https://your-domain.vercel.app/contact` âœ“
   - `https://your-domain.vercel.app/admin` âœ“

2. **Test Navigation**:
   - Click navigation links âœ“
   - Browser back/forward buttons âœ“
   - Refresh on any page âœ“

## ğŸš¨ COMMON VERCEL SPA ISSUES

### Issue: 404 on Direct URL Access
**Symptoms**: `/game` works when navigated to, but 404 when visited directly
**Cause**: Missing rewrite rules
**Fix**: âœ… Implemented in `vercel.json`

### Issue: Assets Not Loading
**Symptoms**: CSS/JS files return 404
**Cause**: Incorrect build output or base path
**Fix**: âœ… Verified `outputDirectory: "dist"` matches Vite build

### Issue: Client-Side Router Conflicts
**Symptoms**: Inconsistent routing behavior
**Cause**: Server-side and client-side routing conflicts
**Fix**: âœ… Router properly handles both modes

## ğŸ”§ DEPLOYMENT COMMANDS

```bash
# Local testing
npm run build
npm run preview

# Deploy to Vercel
vercel --prod

# Check deployment
vercel ls
```

## ğŸ“Š PERFORMANCE IMPACT

The rewrite rule has **minimal performance impact**:
- Single rule covers all routes
- Static assets cached separately
- No server-side processing required

## ğŸ› DEBUGGING TIPS

### If 404s Persist:

1. **Check Vercel Dashboard**:
   - Functions tab â†’ Verify no conflicting API routes
   - Deployments â†’ Check build logs for errors

2. **Verify File Structure**:
   ```
   dist/
   â”œâ”€â”€ index.html          âœ“ Required
   â”œâ”€â”€ assets/            âœ“ Generated by Vite
   â”œâ”€â”€ manifest.webmanifest âœ“ PWA
   â””â”€â”€ sw.js              âœ“ Service Worker
   ```

3. **Test Locally First**:
   ```bash
   npm run build
   npm run preview
   # Test all routes work locally
   ```

4. **Check Browser Network Tab**:
   - 404s should now return `index.html` content
   - Status should be 200, not 404

### Vercel-Specific Checks:

1. **Project Settings**:
   - Framework Preset: Vite âœ“
   - Output Directory: `dist` âœ“
   - Install Command: `npm install` âœ“

2. **Environment Variables**:
   - Ensure all required env vars are set
   - Check Firebase config in production

## ğŸ¯ EXPECTED BEHAVIOR AFTER FIX

âœ… **Direct URL Access**: All routes return `index.html`
âœ… **Client Routing**: JavaScript router handles page rendering  
âœ… **Browser Navigation**: Back/forward buttons work correctly
âœ… **Page Refresh**: Any page can be refreshed without 404
âœ… **SEO Friendly**: Proper meta tags and Open Graph data
âœ… **Performance**: Static assets cached appropriately

## ğŸ“ MONITORING

After deployment, monitor:
- Vercel Analytics for 404 errors
- Browser console for routing issues
- Performance metrics (LCP, FID, CLS)

The fixes implemented should completely resolve your 404 issues! ğŸ§›â€â™€ï¸